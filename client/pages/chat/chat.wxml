<view class="chat-container">
  <!-- ËÉåÊôØÂõæÂíåËíôÁâà -->
  <view class="chat-background" wx:if="{{chatBackgroundImage}}">
    <image class="background-image" src="{{chatBackgroundImage}}" mode="aspectFill" lazy-load="{{false}}" binderror="onBackgroundImageError"></image>
    <view class="background-mask"></view>
  </view>
  
  <!-- ËÅäÂ§©ËÆ∞ÂΩïÂå∫Âüü -->
  <scroll-view class="chat-list" scroll-y scroll-top="{{scrollTop}}" scroll-into-view="{{scrollToMessage}}" bindscroll="onScroll" bindtouchstart="onTouchStart" bindtouchmove="onTouchMove" bindtouchend="onTouchEnd" enhanced="true" show-scrollbar="false">
    <view class="chat-list-content">
      <!-- Êú∫Âô®‰∫∫‰ø°ÊÅØ -->
      <view class="robot-info" wx:if="{{robotInfo}}">
        <image class="robot-avatar" src="{{robotInfo.avatar || robot.avatar}}" mode="aspectFill"></image>
        <view class="robot-name">{{robotInfo.name || robot.name}}</view>
        <view class="robot-desc">{{robotInfo.description}}</view>
      </view>
      <!-- Ê∂àÊÅØÂàóË°® -->
      <block wx:for="{{messages}}" wx:key="id">
        <view id="msg-{{item.id}}">
          <!-- Áî®Êà∑Ê∂àÊÅØ -->
          <view class="message-item user-message" wx:if="{{item.type==='user'}}">
            <!-- Ê∂àÊÅØÂÜÖÂÆπ -->
            <view class="message-wrapper">
              <view class="message-content">
                <text>{{item.content}}</text>
              </view>
              <view class="message-time">{{item.formattedTime}}</view>
            </view>
            <!-- üîß ‰ºòÂåñÔºöÁî®Êà∑Â§¥ÂÉèÊòæÁ§∫ÈÄªËæë -->
            <view class="avatar user-avatar" wx:if="{{userInfo.avatar}}">
              <image src="{{userInfo.avatar}}" mode="aspectFill" binderror="onUserAvatarError"></image>
            </view>
            <view class="avatar user-avatar text-avatar" wx:else>
              <text>{{userInfo.nickname || 'Êàë'}}</text>
            </view>
          </view>
          <!-- Êú∫Âô®‰∫∫Ê∂àÊÅØ -->
          <view class="message-item robot-message" wx:else>
            <!-- Êú∫Âô®‰∫∫Â§¥ÂÉè - ‰ΩøÁî®ÂΩìÂâçÁªëÂÆöÁöÑÊú∫Âô®‰∫∫Â§¥ÂÉè -->
            <view class="avatar robot-avatar" wx:if="{{robot.avatar || robotInfo.avatar}}">
              <image src="{{robot.avatar || robotInfo.avatar}}" mode="aspectFill"></image>
            </view>
            <view class="avatar robot-avatar text-avatar" wx:else>
              <text>Êú∫</text>
            </view>
            <!-- Ê∂àÊÅØÂÜÖÂÆπ -->
            <view class="message-wrapper">
              <view class="message-content">
                <text>{{item.content}}</text>
              </view>
              <view class="message-time">{{item.formattedTime}}</view>
            </view>
          </view>
        </view>
      </block>
      <!-- Âä†ËΩΩ‰∏≠ -->
      <view class="loading" wx:if="{{loading}}">
        <view class="loading-dots">
          <view class="dot"></view>
          <view class="dot"></view>
          <view class="dot"></view>
        </view>
      </view>
      <!-- Âä†ËΩΩÂéÜÂè≤Ê∂àÊÅØ‰∏≠ -->
      <view class="loading-history" wx:if="{{loadingHistory}}">
        <text>Ê≠£Âú®Âä†ËΩΩÂéÜÂè≤Ê∂àÊÅØ...</text>
      </view>
    </view>
  </scroll-view>
  <!-- ËæìÂÖ•Âå∫Âüü -->
  <view class="input-area" style="transform: translateY(-{{keyboardHeight}}px)">
    <input class="message-input" 
           value="{{inputValue}}" 
           placeholder="ËæìÂÖ•Ê∂àÊÅØ..." 
           bindinput="onInput" 
           bindconfirm="onConfirm" 
           confirm-type="send" 
           adjust-position="{{false}}"
           cursor-spacing="20"
           hold-keyboard="{{true}}"
           focus="{{inputFocus}}"
           bindfocus="onInputFocus"
           bindblur="onInputBlur"
           bindkeyboardheightchange="onKeyboardHeightChange" />
    <view class="send-btn {{inputValue ? 'active' : ''}}" bindtap="onSend">ÂèëÈÄÅ</view>
  </view>
</view>